# TODO Issue Sync Agent

Goal: Read `backlog/TODO.md`, group related backlog items, open GitHub issues for each group, and annotate the TODO list with links to the created issues.

Input Sources:
- `backlog/TODO.md` â€“ prioritized checklist generated by the backlog consolidator agent.
- Existing GitHub issues for context (via `gh issue list` / `gh issue view` as needed).

Deliverables:
1. GitHub issues created for every TODO (or group of TODOs) that does not already link to an issue.
2. Updated `backlog/TODO.md` where each newly-created issue is referenced on the corresponding checkbox line using `(See: <issue-url>)`.
3. Run report capturing the issues opened, affected TODO lines, and any TODOs deferred.

Operating Procedure:
1. Parse the TODO file and identify checkbox items lacking an issue link to `github.com/.../issues/`.
2. Cluster related TODOs together. Prefer grouping when:
   - They share the same source tag (e.g., `[Tech Debt #7]`, `Source: Reliability Review`).
   - They have highly similar titles or touch the same component (use judgement; keep clusters small and coherent).
   - They target the same priority section (Critical/High/Medium/Low).
3. For each cluster:
   - Draft a single actionable GitHub issue title that captures the shared theme.
   - Compose a body that lists each TODO as a checklist with context lines beneath it. Include priority and source references.
   - Double-check no existing issue already covers the work (use `gh issue list --search <keywords>` when unsure).
   - Create the issue with `gh issue create --title <title> --body <body> --repo <owner>/<repo>`.
   - Record the returned issue URL.
4. Update `backlog/TODO.md`:
   - Append `(See: <issue-url>)` to each checkbox line that maps to the issue.
   - Preserve the original ordering, priority headings, and indentation.
5. Generate a run report including:
   - `artifacts`: `backlog/TODO.md`.
   - `logs`: summary of groupings, created issue URLs, skipped items, and any manual follow-up needed.
   - `metrics`: counts of TODOs processed, grouped, skipped, and total issues opened.

Constraints:
- Do not modify TODO items that already contain an issue link.
- Use the repository specified by `REPO_DIR` / `repo` in the environment when running `gh` commands.
- Respect rate limits and avoid duplicate issue creation; reuse an issue if it already exists.
- Keep groups tightly scoped. If a TODO clearly stands alone, give it a dedicated issue.
- Maintain checkbox state (`[ ]` vs `[x]`). Never mark TODOs complete.

Completion Checklist:
- [ ] All eligible TODOs have associated GitHub issues.
- [ ] `backlog/TODO.md` references each new issue.
- [ ] Run report JSON at `${REPORT_PATH}` lists newly opened issues and processing metrics.
